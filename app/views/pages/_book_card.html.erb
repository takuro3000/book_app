<div class="col-12 col-md-4 col-lg-3 mb-4">
  <%= link_to book_path(book), class: "card product-card h-100" do %>
    <%= image_tag book.image, class: "card-img-top" %>
    <div class="card-body">      
      <div class="difficulty-rating-container d-flex align-items-center justify-content-center">
        <span class="difficulty-level">難易度Lv: <%= book.avg_difficulty %></span>
        <small class="review-count ml-2">
          （<i class="fa-regular fa-comment"></i>
          <%= book.posts.count %>）
        </small>
      </div>

      <div class="difficulty-icons mb-2 text-center">
        <% 1.upto(5) do |i| %>
          <% if book.avg_difficulty >= i %>
            <!-- 完全に塗られたアイコン -->
            <i class="bi bi-book-fill icon-active"></i>
          <% elsif book.avg_difficulty < i - 1 %>
            <!-- 全く塗られていないアイコン -->
            <i class="bi bi-book-fill icon-inactive"></i>
          <% else %>
            <!-- 小数部分がある場合 -->
            <% fraction = book.avg_difficulty - (i - 1) %>
            <span class="icon-partial-wrapper">
              <!-- 背景：塗られていない状態 -->
              <i class="bi bi-book-fill icon-inactive"></i>
              <!-- 前面：塗られた状態。fraction分だけ表示 -->
              <i class="bi bi-book-fill icon-active partial-fill" style="width: <%= (fraction * 100).round %>%"></i>
            </span>
          <% end %>
        <% end %>
      </div>
      
      <p class="card-text book-title"><span><%= book.title %></span></p>
    </div>
  <% end %>
</div>
